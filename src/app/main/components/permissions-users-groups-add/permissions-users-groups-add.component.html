<form [formGroup]="addUserForm">

<div fxLayout="column" fxLayoutAlign="start" style="width: 100%;" fxLayoutGap="20px">
  <div fxLayout="row" fxLayoutAlign="start" >
    <div fxFlex>
            <span style="font-weight: bolder">
                Add users
            </span>
    </div>
  </div>
  <div fxLayout="row" fxLayoutAlign="start" fxLayoutGap="15px">
    <div fxFlex>

      <mat-form-field>
        <input #inputSearch
               type="text"
               name="inputSearch"
               matInput
               [matAutocomplete]="autoSearchUsersAndGroups"
               placeholder="Search by name, groupsâ€¦"
               [formControlName]="'userOrGroupInput'">
        <!--addUserForm.get('userOrGroupInput')-->
        <button mat-button matSuffix mat-icon-button aria-label="Clear" (click)="searchUsersAndGroups(inputSearch.value)">
          <mat-icon>search</mat-icon>
        </button>
        <mat-autocomplete #autoSearchUsersAndGroups="matAutocomplete" fxFlex="40">
          <mat-option *ngFor="let userOrGroup of filteredUsersAndGroups$ | async" placeholder="placeholder"
                      (click)="addToList(userOrGroup)">
            <div *ngIf="userOrGroup.type === 'user' else templateGroup;" fxLayout="row" fxLayoutAlign="start center">
              <mat-icon>person</mat-icon>
              <span>
                {{userOrGroup.element.firstName
              + ' '
              + userOrGroup.element.lastName
              + ' (' + userOrGroup.element.uid + '@' + userOrGroup.element.source
              + ')'}}
              </span>
            </div>
            <ng-template #templateGroup>
              <div fxLayout="row" fxLayoutAlign="start center">
                <mat-icon>person</mat-icon>
                <span>
                  {{userOrGroup.element.name + ' (' + userOrGroup.element.gid + '@' + userOrGroup.element.source + ')'}}
                </span>
              </div>
            </ng-template>
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>
    </div>
  </div>

  <ng-container [formGroup]="addUserForm.get('securities')" >
  <div
          *ngFor="let permission of permissions; let i = index"
          fxLayout="row"
          fxLayoutAlign="start center"
          fxLayoutGap="15px"
          [formGroup]="addUserForm.get('securities').get(i.toString())">
    <div fxFlex>
      <div fxLayout="column" >
        <div>
          <span style="font-weight: bolder">{{permission.fullName}}</span>
        </div>
        <div>
          <span>{{permission.name + '@' + permission.source}}</span>
        </div>
      </div>
    </div>
    <div [class.permission-cell-header]="true"
         fxLayout="row" fxLayoutAlign="center center">
      <div><mat-checkbox [formControlName]="'read'"></mat-checkbox></div>
    </div>
    <div [class.permission-cell-header]="true"
         fxLayout="row" fxLayoutAlign="center center">
      <div><mat-checkbox [formControlName]="'write'"></mat-checkbox></div>
    </div>
    <div [class.permission-cell-header]="true"
         fxLayout="row" fxLayoutAlign="center center">
      <div><mat-checkbox [formControlName]="'fullAccess'"></mat-checkbox></div>
    </div>
  </div>
  </ng-container>

  <div >
    <div fxLayout="row"
         fxLayoutAlign="center center"
         fxLayoutGap="20px">
      <div [class.kimios-button]="true"
           [class.kimios-green]="true"
           [class.inactive]="true"
           fxLayout="row"
           fxLayoutAlign="center center"
           (click)="cancel($event)">
        <span [class.kimios-button-text]="true">CANCEL</span>
      </div>
      <div [class.kimios-button]="true"
           [class.kimios-green]="true"
           [class.active]="true"
           fxLayout="row"
           fxLayoutAlign="center center"
           (click)="submit($event)">
        <span class="kimios-button-text">ADD USERS</span>
      </div>
    </div>
  </div>
</div>

</form>
